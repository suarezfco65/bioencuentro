<!DOCTYPE html>
<html>
    <head>
        <title>Probar Músicas</title>
    <meta charset="utf-8">
        <script src="dir.js" lang="javascript"></script>
        <script src="documento.js" lang="javascript"></script>
    <style>
        .autor      {color: crimson;}
        .cancion    {color: darkslateblue;}
        .desc       {color: green; font-weight: bold}
        .consigna   {color: orangered}
        .rb {
            position: fixed;
            top:95px;
            right: 5px;
            font-size: 20px;
        }
    </style>
    </head>
<body>
    <script>
var playlist = new Object();
    playlist.danzas = [
        {id:  1, tipoDanza: 1, danza: 1, cancion: 4, evolucion: 1, min:2, seg:29 },
        {id:  2, tipoDanza: 2, danza: 1, cancion: 9, evolucion: 2, min:3, seg:38 },
        {id:  3, tipoDanza: 3, danza:16, cancion: 6, evolucion: 3, min:2, seg:12 },
        {id:  4, tipoDanza:14, danza: 2, cancion: 1, evolucion: 2, min:5, seg:07 },
        {id:  5, tipoDanza: 6, danza: 1, cancion: 1, evolucion: 1, min:3, seg:24 },
        {id:  6, tipoDanza: 3, danza:13, cancion:13, evolucion: 0, min:3, seg:46 },
        {id:  7, tipoDanza: 7, danza: 2, cancion: 4, evolucion:-1, min:2, seg:48 },
        {id:  8, tipoDanza: 7, danza: 3, cancion: 3, evolucion:-2, min:4, seg:30 },
        {id:  9, tipoDanza:19, danza: 4, cancion: 1, evolucion:-3, min:2, seg:24 },
        {id: 10, tipoDanza:10, danza: 1, cancion: 8, evolucion:-2, min:2, seg:31 },
        {id: 11, tipoDanza: 3, danza:15, cancion: 7, evolucion:-1, min:3, seg:26 },
        {id: 12, tipoDanza: 1, danza:14, cancion: 4, evolucion: 0, min:3, seg:49 }
    ]
    playlist.pos = 0;
    playlist.end = playlist.danzas-1;
    playlist.duracion = 20;
    playlist.tiposDanzas = arrTiposDanzas;
    </script>
<form>
<table align="center">
    <thead>
    <tr><th colspan="2">Prueba de Música de las Danzas</th></tr>
    </thead>
    <tbody>
    <tr><td>Duración de la prueba x canción:</td>
        <td><input name="duracion" type="text" size="3" maxlength="3" value="10"></td></tr>
    <tr><td>Desde que Danza:</td>
        <td><select name="desdeDanza">
            <script>
                for (var i=0; i<playlist.danzas.length; i++)   {
                    document.write('<option value="'+i+'" '+((i==0)?'selected':'')+'>'+
                                   (i+1)+'. '+playlist.tiposDanzas[playlist.danzas[i].tipoDanza-1].arrDanzas[playlist.danzas[i].danza-1].nombre+
                                   '('+playlist.danzas[i].evolucion+')</option>');
                }
            </script>
            </select></td></tr>
    <tr><td>Hasta que Danza:</td>
        <td><select name="hastaDanza">
            <script>
                for (var i=0; i<playlist.danzas.length; i++)   {
                    document.write('<option value="'+i+'" '+((i==(playlist.danzas.length-1))?'selected':'')+'>'+
                                   (i+1)+'. '+playlist.tiposDanzas[playlist.danzas[i].tipoDanza-1].arrDanzas[playlist.danzas[i].danza-1].nombre+
                                   '('+playlist.danzas[i].evolucion+')</option>');
                }
            </script>
            </select></td></tr>
    <tr><td colspan="2" align="center"><button onclick="iniciarPrueba(this.form)" type="button">Iniciar Prueba</button></td></tr>
    </tbody>
</table>
</form>
    <br>
<table align="center" style="background-color:rgb(241,243,244); width:320px">
    <tr><td align="center"><audio id="audio" controls>
        <source id="ogg" src="" type="audio/ogg">
        <source id="mp3" src="" type="audio/mpeg">
        Your browser does not support the audio element.
        </audio>
    </td></tr>
    <tr><td id="danza"></td></tr>
    <tr><td style="font-size: 12px"><span id="musica" class="cancion"></span>, <span id="autor" class="autor"></span></td></tr>
</table>
<script>
    function iniciarPrueba (oform)   {
        playlist.duracion    = oform.elements.namedItem("duracion").value;
        var oSelect =   oform.elements.namedItem("desdeDanza");
        playlist.pos    = oSelect.options[oSelect.selectedIndex].value;
        oSelect =   oform.elements.namedItem("hastaDanza");
        playlist.end    = oSelect.options[oSelect.selectedIndex].value;
        if (playlist.pos <= playlist.end) playlist.play();
    }
    playlist.objAudio = document.getElementById('audio');
    playlist.getMusica  =   function(td, d, c)  {
        var cancion = playlist.tiposDanzas[td-1].arrDanzas[d-1].arrCanciones[c-1];
        if (cancion.disco == '00' && cancion.pista == '00')
            return {nombre:"No Aplica", autor:"No Aplica", archivo:""};
        var resultado = arrayCanciones.find(song => song.disco===cancion.disco && song.pista===cancion.pista)
        if (resultado == undefined)
            return {nombre:"No Encontrada ("+cancion.disco+"-"+cancion.pista+")", autor:"", archivo:""};
        document.getElementById('musica').innerHTML = resultado.nombre;
        document.getElementById('autor').innerHTML = resultado.autor;
        document.getElementById('danza').innerHTML = playlist.tiposDanzas[td-1].arrDanzas[d-1].nombre;
        return resultado;
    }
    playlist.cargarDanza =   function    (td,d,c)    {
        var musica = playlist.getMusica(td,d,c);
        var obj = document.getElementById('mp3');
        obj.src =musica.archivo;
        obj = document.getElementById('ogg');
        obj.src =musica.archivo.substr(0,musica.archivo.length-3)+'ogg';
        playlist.objAudio.load();
    }

    playlist.objAudio.ondurationchange = function() {
        var duracion = playlist.objAudio.duration;
        playlist.objAudio.play();
        playlist.objAudio.currentTime = (duracion/2-playlist.duracion/2);
        setTimeout(function(){ 
            playlist.objAudio.currentTime = (duracion-1);
        }, playlist.duracion*1000);
    };
    playlist.objAudio.onended = function() {
        playlist.pos++;
        if (playlist.pos <= playlist.end) playlist.play();
    };
    playlist.play = function ()  {
        playlist.cargarDanza(playlist.danzas[playlist.pos].tipoDanza,
                             playlist.danzas[playlist.pos].danza,
                             playlist.danzas[playlist.pos].cancion);
    }
    
</script>

</body>
</html>