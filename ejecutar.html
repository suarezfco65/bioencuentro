<!DOCTYPE html>
<html>
<head>
    <title>Ejecutar Sesión</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="corazon.png">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>    
    <script src="documento.js"></script>
    <script src="dir.js"></script>
    <script src="navbar.js"></script>
    <style>
        .autor      {color: crimson;}
        .cancion    {color: darkslateblue;}
        .desc       {color: green; font-weight: bold}
        .consigna   {color: orangered}
        .rb {
            position: fixed;
            top:100px;
            right: 5px;
            font-size: 20px;
        }
    </style>
    <script>
        isMobile = {
            mobilecheck : function() {
                return (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||window.opera).substr(0,4)))
            }
        }
    </script>

</head>
<body>
<div ng-app="myApp" ng-controller="sesionCrtl" style="margin-top:50px">
<div class="container">
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">Yo<span style="color:red">❤</span>Biodanza</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav">
          </ul>
          <span class="navbar-text navbar-right" style="color:white">Ejecutar Sesión&nbsp;&nbsp;</span>
        </div>
      </div>
    </nav>
    <div class="rb">
        <audio id="audio" controls>
            <source id="ogg" src="" type="audio/ogg">
            <source id="mp3" src="" type="audio/mpeg">
        </audio>
        <audio id="audio2">
            <source id="ogg2" src="" type="audio/ogg">
            <source id="mp32" src="" type="audio/mpeg">
        </audio>
        <span  onclick="fade('audio',5)" style="cursor: crosshair;">&nbsp;&nbsp;&nbsp;</span>
    </div>
    
<div class="container-fluid">
    <h3 style="color:red; font-weight: bold; margin-bottom: 40px ">Ejecutar Sesión</h3>
  <div class="row">
    <div class="col-12 text-primary"><h1><b>{{tema}}</b></h1></div>
  </div>
  <div class="row">
    <div class="col-12 text-info">Realizado por: <b>{{autor}}</b></div>
  </div>
</div>
<!-- <script>if (!isMobile.mobilecheck()) inicioContenido('Prueba Controlada', 4, 'divPrueba');</script>
    <div ng-hide="mobilecheck"> -->
<script>inicioContenido('Prueba Controlada', 4, 'divPrueba');</script>
    <div>
<form class="form-inline">
    <div class="input-group">
        <span class="input-group-addon" style="font-family:monospace;">Desde&nbsp;</span>
        <select ng-model="desde" ng-options="d.id as d.nombre for d in danzas" class="form-control input-sm" id="desde"></select>
    </div>
</form>
<form class="form-inline">
    <div class="input-group">
        <span class="input-group-addon" style="font-family:monospace;">Hasta&nbsp;</span>
        <select ng-model="hasta" ng-options="d.id as d.nombre for d in danzas" class="form-control input-sm" id="hasta"></select>
    </div>
</form>
<form class="form-inline">
    <div class="input-group">
        <span class="input-group-addon" style="font-family:monospace;">Inicio</span>
        <input id="durInicio" type="text" class="form-control input-sm" ng-model="durInicio" size="3">
    </div>
    <div class="input-group">
        <span class="input-group-addon" style="font-family:monospace;">Medio&nbsp;</span>
        <input id="durMedio" type="text" class="form-control input-sm" ng-model="durMedio" size="3">
    </div>
    <div class="input-group">
        <span class="input-group-addon" style="font-family:monospace;">Final&nbsp;</span>
        <input id="durFinal" type="text" class="form-control input-sm" ng-model="durFinal" size="3">
    </div>
    <div class="form-group">
        <button type="button" class="btn btn-success" ng-click="iniciarPrueba()" id="pr">Iniciar</button>
    </div>
</form>
    </div>
<!-- <script>if (!isMobile.mobilecheck()) finContenido();</script> -->
<script>finContenido();</script>
<script>inicioContenido('Ejecución Controlada', 4, 'divEjecucion');</script>
<form class="form-inline">
    <div class="input-group">
        <span class="input-group-addon" style="font-family:monospace;">Desde&nbsp;</span>
        <select ng-model="desde" ng-options="d.id as d.nombre for d in danzas" class="form-control input-sm" id="desde"></select>
    </div>
</form>
<form class="form-inline">
    <div class="input-group">
        <span class="input-group-addon" style="font-family:monospace;">Hasta&nbsp;</span>
        <select ng-model="hasta" ng-options="d.id as d.nombre for d in danzas" class="form-control input-sm" id="hasta"></select>
    </div>
    <div class="form-group">
        <button type="button" class="btn btn-success" ng-click="iniciarSesion()" id="pr">Iniciar</button>
    </div>
</form>
<script>finContenido();</script>
    <table>
    <thead>
        <tr>
            <th>#</th>
            <th>Danza</th>
            <th>Evolución</th>
            <th colspan="2">&nbsp;Controles</th>
        </tr>
        <tr><td colspan="5"><hr></td></tr>
    </thead>
    <tbody>
        <tr ng-repeat="d in danzas"  id="{{'tr'+d.id}}">
            <td valign="top">{{d.id}}.&nbsp;</td>
            <td><p>{{ tiposDanzas[d.tipoDanza-1].arrDanzas[d.danza-1].nombre }}<br>
            <i>{{getCancion(d.tipoDanza,d.danza,d.cancion).disco}}-{{getCancion(d.tipoDanza,d.danza,d.cancion).pista}}&nbsp;</i>
            <span class="autor">{{getCancion(d.tipoDanza,d.danza,d.cancion).autor}}</span>: <br>
            <span class="cancion">{{getCancion(d.tipoDanza,d.danza,d.cancion).nombre}}</span></p>
            </td>
            <td valign="top" align="center"><b>{{d.evolucion}}</b><br>{{d.min}}:{{(d.seg<10) ? '0'+d.seg : d.seg}}</td>
            <td valign="top"><button type="button" class="btn btn-success" ng-click="playColor(d.id);playDanza(d.tipoDanza,d.danza,d.cancion)">&#9835;</button>&nbsp;</td>
            <td valign="top"><button type="button" class="btn btn-success" ng-click="descDanza(d.id)" data-toggle="modal" data-target="#descModal"><i class="fa fa-book"></i></button></td>
        </tr>
        <tr><td colspan="5"><hr></td></tr>
    </tbody>
    <tfoot>
        <tr>
            <td colspan="5">
    <div id="grafico"></div>
            </td>
        </tr>
    </tfoot>
    </table>
    <br>
    <hr>
    <br>

    <!-- The Modal for Describir danza-->
    <div class="modal fade" id="descModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">{{descTitle}}</h4>
            </div>

            <!-- Modal body -->
            <div class="modal-body"  id="descBody">
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-success w3-ripple" data-dismiss="modal">Cerrar</button>
            </div>

            </div>
        </div>
    </div>    
<ul id="tiempos">
</ul>    
<script>
angular.module('myApp', []).controller('sesionCrtl', function($scope) {
    $scope.objAudio = document.getElementById("audio");
    $scope.iniciarPrueba   =   function    ()  {
        var prueba  =   new Object();
        prueba.pos = $scope.desde+0;
        prueba.end = $scope.hasta+0;
        prueba.duracion = 0;
        $scope.objAudio.oncanplaythrough = function() {
            document.getElementById("tiempos").innerHTML += "<li>Danza ("+prueba.pos+"); currentTime ("+$scope.objAudio.currentTime+")</li>"
            prueba.duracion = $scope.objAudio.duration;
            if ($scope.objAudio.currentTime < 1)   {
                setTimeout(function(){
                    $scope.objAudio.currentTime = Math.trunc(prueba.duracion/2-$scope.durMedio/2);
                }, $scope.durInicio*1000)
            }
            else if (($scope.objAudio.currentTime <= (0.1+prueba.duracion/2-$scope.durMedio/2)) && 
                     ($scope.objAudio.currentTime > ($scope.durInicio-0.5)) ) 
                setTimeout(function(){
                    $scope.objAudio.currentTime = (prueba.duracion-$scope.durFinal);
                }, $scope.durMedio*1000);  
        }

        $scope.objAudio.onended = function() {
            prueba.pos++;
            if (prueba.pos > prueba.end) {
                $scope.objAudio.oncanplaythrough = function() {};
                $scope.objAudio.onended = function() {};
            }   else    prueba.play();
        };
        prueba.play = function ()  {
            $scope.playColor(prueba.pos)
            $scope.loadMusica(
                $scope.danzas[prueba.pos-1].tipoDanza,
                $scope.danzas[prueba.pos-1].danza,
                $scope.danzas[prueba.pos-1].cancion,
                "audio");
                $scope.objAudio.play();
        }
        prueba.play();
    }
    $scope.iniciarSesion   =   function    ()  {
        var sesion  =   new Object();
        $scope.objAudio.ondurationchange = function() {};
        sesion.pos = $scope.desde+0;
        sesion.end = $scope.hasta+0;
        $scope.objAudio.onended = function() {
            sesion.pos++;
            if (sesion.pos <= sesion.end) sesion.play() 
            else {
                $scope.objAudio.onended = function() {};
            }
        };
        sesion.play = function ()  {
            $scope.playColor(sesion.pos);
            $scope.loadMusica($scope.danzas[sesion.pos-1].tipoDanza,
                              $scope.danzas[sesion.pos-1].danza,
                              $scope.danzas[sesion.pos-1].cancion, "audio");
            alert('Indique la consigna, para la danza\n\n'+sesion.pos+'. '+
                  $scope.tiposDanzas[$scope.danzas[sesion.pos-1].tipoDanza-1].arrDanzas[$scope.danzas[sesion.pos-1].danza-1].nombre);
            var mostrar = confirm('¿Va a realizar muestra para ésta danza?');
            if (mostrar)    {
                alert('Al darle Click, la música iniciará en 10 segundos, y podrá iniciar la muestra de la danza')
                setTimeout(function(){ 
                    $scope.objAudio.play();    
                    setTimeout(function(){ 
                        alert('click para detener la musica');
                        var volumen = $scope.objAudio.volume;
                        fade('audio',3);
                        setTimeout(function(){
                            $scope.objAudio.pause()
                            $scope.objAudio.currentTime = 0;
                            $scope.objAudio.volume=volumen;
                            alert('Invite a danzar');
                            $scope.objAudio.play();    
                        }, 3500);
                    }, 15000);
                }, 10000);
            }   else    {
                alert('Invite a danzar')
                $scope.objAudio.play();
            }
        }
        sesion.play();
    }
    $scope.tiposDanzas = arrTiposDanzas;
    $scope.canciones = arrayCanciones;
    $scope.play =   function    (td,d,c)    {
        cancion = $scope.getCancion(td,d,c);
        $scope.archivo= cancion.archivo;
    }
    $scope.getCancion  =   function(td, d, c)  {
        var cancion = $scope.tiposDanzas[td-1].arrDanzas[d-1].arrCanciones[c-1];
        if (cancion.disco == '00' && cancion.pista == '00')
            return {nombre:"No Aplica", autor:"No Aplica", archivo:""};
        var resultado = $scope.canciones.find(song => song.disco===cancion.disco && song.pista===cancion.pista)
        if (resultado == undefined)
            return {nombre:"No Encontrada ("+cancion.disco+"-"+cancion.pista+")", autor:"", archivo:""};
        return resultado;
    }
    $scope.getDanzas    =   function()  {
        var arr = [];
        for (var i=0; i<$scope.danzas.length; i++)
            arr.push($scope.tiposDanzas[$scope.danzas[i].tipoDanza-1].arrDanzas[$scope.danzas[i].danza-1].nombre);
        return arr
    }
    $scope.desde=null;
    $scope.hasta=null;
    $scope.prueba=false;
    $scope.durInicio = 10;
    $scope.durMedio = 20;
    $scope.durFinal = 15;
    $scope.id=0;
    $scope.tipoDanza = 0;
    $scope.danza = 0;
    $scope.cancion = 0;
    $scope.evolucion = 0;
    $scope.tema ="";
    $scope.autor = "";
    $scope.min = 0;
    $scope.seg = 0;
    $scope.danzas   = [];
    $scope.loadMusica =  function    (td,d,c,id)    {
        var sufijo = (id == "audio") ? "":"2";
        cancion = $scope.getCancion(td,d,c);
        objAudio = document.getElementById('mp3'+sufijo);
        objAudio.src =cancion.archivo;
        objAudio = document.getElementById('ogg'+sufijo);
        objAudio.src =cancion.archivo.substr(0,cancion.archivo.length-3)+'ogg';
        objAudio = document.getElementById(id);
        objAudio.load();
    }
    $scope.recuperarSesion =    function()  {
        var valores = 'mnbvcxzlkjhgfdsapoiuytrewq0987654321MNBVCXZLKJHGFDSAPOIUYTREWQ|-,.;:';
        const inicio = -7;
        var getQueryStringValue = function (key) {  
                return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURIComponent(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));  
        }
        $scope.tema = getQueryStringValue("tema");
        $scope.autor = getQueryStringValue("autor");
        
        var codDanzas = getQueryStringValue("danzas");
        
        for (var i = 0; i<codDanzas.length;i+=5)    {
            var danza = {id:0, tipoDanza:0, danza:0, cancion:0, evolucion:0};
            danza.id        =valores.indexOf(codDanzas.substr(i,1))+inicio;
            danza.tipoDanza =valores.indexOf(codDanzas.substr(i+1,1))+inicio;
            danza.danza     =valores.indexOf(codDanzas.substr(i+2,1))+inicio;
            danza.cancion   =valores.indexOf(codDanzas.substr(i+3,1))+inicio;
            danza.evolucion =valores.indexOf(codDanzas.substr(i+4,1))+inicio;
            danza.min       =0;
            danza.seg       =0;
            danza.nombre    =danza.id+'. '+$scope.tiposDanzas[danza.tipoDanza-1].arrDanzas[danza.danza-1].nombre+' ('+danza.evolucion+')'
            $scope.danzas.push(danza);
        }
        if  (codDanzas.length>0)    {
            $scope.getDuracion();
            $scope.desde=$scope.danzas[0].id
            $scope.hasta=$scope.danzas[$scope.danzas.length-1].id
        }
    }
    $scope.getDuracion  =   function()  {
        var loadlist = new Object();
        loadlist.objAudio = document.getElementById('audio2');
        loadlist.objAudio.oncanplay = function() {
            var duracion = loadlist.objAudio.duration;
            $scope.danzas[loadlist.pos].min = Math.trunc(duracion / 60);
            $scope.danzas[loadlist.pos].seg = Math.trunc(duracion - (Math.trunc(duracion/60) * 60));
            loadlist.pos++;
            if (loadlist.pos < $scope.danzas.length) 
                loadlist.load()
            else    {
                Highcharts.chart('grafico', $scope.opciones);
                $scope.$digest();
                loadlist = null;
            }
        };
        loadlist.load = function ()  {
            $scope.loadMusica($scope.danzas[loadlist.pos].tipoDanza,
                              $scope.danzas[loadlist.pos].danza,
                              $scope.danzas[loadlist.pos].cancion, 'audio2');
        }
        loadlist.pos = 0;
        loadlist.load();
    }
    $scope.recuperarSesion();
    $scope.valores = [0,1,2,3,4,5,-1,-2,-3,-4,-5];

    var myArrayMax = function(arr) {
      var len = arr.length;
      var max = 0;
      while (len--) {
        if (arr[len].id > max) {
          max = arr[len].id;
        }
      }
      return max;
    }
    
    var chkDanza = function (d)  {
        return (d.id == $scope.id)
    }

    $scope.grafico  =   function()  {
        $scope.cat  =   ["ESTADO INICIAL"];
        $scope.dat  =   [0];
        for(var i=0; i<$scope.danzas.length;i++)    {
            var danza = arrTiposDanzas[$scope.danzas[i].tipoDanza-1].arrDanzas[$scope.danzas[i].danza-1].nombre;
            $scope.cat.push(danza.length < 30 ? danza : danza.substr(0, 27)+'...');
            $scope.dat.push($scope.danzas[i].evolucion);
        }
        $scope.opciones = {
            chart: {
                type: 'spline'
            }, 
            title: {
                text: $scope.tema
            },

            subtitle: {
                text: 'Realizado por: '+$scope.autor
            },

            xAxis: {
                categories: $scope.cat
            },
            yAxis: {
                title: {
                    text: 'Colinérgico - + - Adrenérgico'
                },
                labels: {
                    formatter: function () {
                        return this.value;
                    }
                }
            },
            tooltip: {
                crosshairs: true,
                shared: true
            },
            plotOptions: {
                spline: {
                    marker: {
                        radius: 4,
                        lineColor: '#666666',
                        lineWidth: 1
                    }
                }
            },

            series: [{
                name: 'nivel',
                marker: {
                    symbol: 'square'
                },
                data: $scope.dat
            }]

        }
        
    }

    $scope.grafico();
    
    $scope.maxCar    =   function()  {
        var total = screen.width;
        var fijo  = 350;
        return Math.round((total-fijo)/8.5);
    }

    $scope.idplay = null;
    $scope.playColor    =   function (id)   {
        if ($scope.idplay != null)  {
            document.getElementById('tr'+$scope.idplay).style.backgroundColor="white";
            $scope.opciones.series[0].data[$scope.idplay-1]=$scope.danzas[$scope.idplay-1].evolucion;
        }
        document.getElementById('tr'+id).style.backgroundColor="#D0D0FF";
        $scope.opciones.series[0].data[id]= {
            y: $scope.danzas[id-1].evolucion,
            marker: {
                symbol: 'diamond'
            }
        }
        $scope.idplay = id;
    }
    $scope.playDanza =   function    (td,d,c)    {
        $scope.objAudio.onloadeddata = function() {};
        $scope.objAudio.onended = function() {};
        $scope.loadMusica(td,d,c,'audio');
        $scope.objAudio.play();
    }
    $scope.getCancion  =   function(td, d, c)  {
        var cancion = $scope.tiposDanzas[td-1].arrDanzas[d-1].arrCanciones[c-1];
        if (cancion.disco == '00' && cancion.pista == '00')
            return {nombre:"No Aplica", autor:"No Aplica", archivo:""};
        var resultado = arrayCanciones.find(song => song.disco===cancion.disco && song.pista===cancion.pista)
        if (resultado == undefined)
            return {nombre:"No Encontrada ("+cancion.disco+"-"+cancion.pista+")", autor:"", archivo:""};
        return resultado;
    }
    $scope.descTitle = "";
    $scope.descDanza    =   function    (id)    {
        var danza = $scope.danzas.find(e => e.id == id);
        var d = $scope.tiposDanzas[danza.tipoDanza-1].arrDanzas[danza.danza-1]
        $scope.descTitle = d.nombre
        document.getElementById("descBody").innerHTML = d.descripcion.substr(0, d.descripcion.indexOf('Música'))
    }

    $scope.mobilecheck = isMobile.mobilecheck();
})
</script>
        </div>
    </div>
</body>
</html>
<script>
        /*
        prueba.desde    = 0;
        prueba.cantidad = 0;
        $scope.test =   function(fase)  {
            prueba.cantidad++;
            document.getElementById('fases').innerHTML +="<li>"+fase+"</li>";
            if (prueba.desde == 0)  {
                prueba.duracion = $scope.objAudio.duration;
                if (prueba.duracion > 0)    {
                    prueba.desde = Math.trunc(prueba.duracion/2-$scope.duracion/2)
                    $scope.objAudio.currentTime = prueba.desde;
                    prueba.desde = $scope.objAudio.currentTime;
                    if (prueba.desde > 0)   {
                        document.getElementById("fase").innerHTML=fase
                        setTimeout(function(){
                            $scope.objAudio.currentTime = (prueba.duracion-1);
                        }, $scope.duracion*1000);
                    }
                }
            }
        }
        $scope.objAudio.addEventListener("loadstart",       function() {  $scope.test("onloadstart")  } );
        $scope.objAudio.addEventListener("durationchange",  function() {  $scope.test("ondurationchange")  } );
        $scope.objAudio.addEventListener("loadedmetadata",  function() {  $scope.test("onloadedmetadata")  } );
        $scope.objAudio.addEventListener("loadeddata",      function() {  $scope.test("onloadeddata")  } );
        $scope.objAudio.addEventListener("progress",        function() {  $scope.test("onprogress")  } );
        $scope.objAudio.addEventListener("canplay",         function() {  $scope.test("oncanplay")  } );
        $scope.objAudio.addEventListener("canplaythrough",  function() {  $scope.test("oncanplaythrough")  } );
        $scope.objAudio.addEventListener("abort",           function() {  $scope.test("abort")  } );
        $scope.objAudio.addEventListener("emptied",         function() {  $scope.test("emptied")  } );
        $scope.objAudio.addEventListener("encrypted",       function() {  $scope.test("encrypted")  } );
        $scope.objAudio.addEventListener("error",           function() {  $scope.test("error")  } );
        $scope.objAudio.addEventListener("interruptbegin",  function() {  $scope.test("interruptbegin")  } );
        $scope.objAudio.addEventListener("interruptend",    function() {  $scope.test("interruptend")  } );
        $scope.objAudio.addEventListener("mozaudioavailable", function() {  $scope.test("mozaudioavailable")  } );
        $scope.objAudio.addEventListener("pause",           function() {  $scope.test("pause")  } );
        $scope.objAudio.addEventListener("play",            function() {  $scope.test("play")  } );
        $scope.objAudio.addEventListener("playing",         function() {  $scope.test("playing")  } );
        $scope.objAudio.addEventListener("ratechange",      function() {  $scope.test("ratechange")  } );
        $scope.objAudio.addEventListener("seeked",          function() {  $scope.test("seeked")  } );
        $scope.objAudio.addEventListener("seeking",         function() {  $scope.test("seeking")  } );
        $scope.objAudio.addEventListener("stalled",         function() {  $scope.test("stalled")  } );
        $scope.objAudio.addEventListener("suspend",         function() {  $scope.test("suspend")  } );
        $scope.objAudio.addEventListener("timeupdate",      function() {  $scope.test("timeupdate")  } );
        $scope.objAudio.addEventListener("volumechange",    function() {  $scope.test("volumechange")  } );
        $scope.objAudio.addEventListener("waiting",         function() {  $scope.test("waiting")  } );
        */
</script>